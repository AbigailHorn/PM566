---
title: "Text Mining"
subtitle: "PM566 - Week 8"
author: "Emil Hvitfeldt"
date: ""
output:
  xaringan::moon_reader:
    css: ["theme.css", "default"]
    lib_dir: libs
    nature:
      beforeInit: "macros.js"
      ratio: "16:9"
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
      titleSlideClass: [center, middle]
---

```{r include=FALSE}
library(knitr)
hook_output <- knit_hooks$get("output")
knit_hooks$set(output = function(x, options) {
  lines <- options$output.lines
  if (is.null(lines)) {
    return(hook_output(x, options))  # pass to default hook
  }
  x <- unlist(strsplit(x, "\n"))
  more <- "..."
  if (length(lines) == 1) {        # first n lines
    if (length(x) > lines) {
      # truncate the output, but add ....
      x <- c(head(x, lines), more)
    }
  } else {
    x <- c(more, x[lines], more)
  }
  # paste these lines together
  x <- paste(c(x, ""), collapse = "\n")
  hook_output(x, options)
})
knit_hooks$set(output = function(x, options) {
  # this hook is used only when the linewidth option is not NULL
  if (!is.null(n <- options$linewidth)) {
    x = knitr:::split_lines(x)
    # any lines wider than n should be wrapped
    if (any(nchar(x) > n)) x = strwrap(x, width = n)
    x = paste(x, collapse = '\n')
  }
  hook_output(x, options)
})

opts_chunk$set(
  echo = TRUE,
  fig.width = 7, 
  fig.align = 'center',
  fig.asp = 0.618, # 1 / phi
  out.width = "700px")
```

```{r, echo = FALSE}
library(sass)
sass(sass_file("theme.sass"), output = "theme.css")
```

# Plan for the week

- We will try to turn text into numbers
- Then use tidy principals to explore those numbers

---

# Tidytext

![](images/tidytext.png)

---

# Why tidytext?

Works seemlessly with ggplot2, dplyr and tidyr.

**Alternatives:**

**R**: quanteda, tm, koRpus

**Python**: nltk, Spacy, gensim

---

# Alice's Adventures in Wonderland

```{r}
#devtools::install_github("EmilHvitfeldt/tidygutenbergr")
library(tidygutenbergr)

alice <- alices_adventures()
```

---

# Turning the data into a tidy format

```{r}
alice
```

---

# Turning the data into a tidy format

```{r}
library(tidytext)
alice %>%
  unnest_tokens(token, text)
```

---

# Words as a unit

Now that we have words as the observation unit we can use the **dplyr** toolbox.

---

# Using dplyr verbs

.pull-left[
```{r dplyr1, eval=FALSE}
library(dplyr)
alice %>%
  unnest_tokens(token, text)
```
]

.pull-right[
```{r ref.label="dplyr1", echo=FALSE}
```
]

---

# Using dplyr verbs

.pull-left[
```{r dplyr2, eval=FALSE}
library(dplyr)
alice %>%
  unnest_tokens(token, text) %>%
  count(token)
```
]

.pull-right[
```{r ref.label="dplyr2", echo=FALSE}
```
]

---

# Using dplyr verbs

.pull-left[
```{r dplyr3, eval=FALSE}
library(dplyr)
alice %>%
  unnest_tokens(token, text) %>%
  count(token, sort = TRUE)
```
]

.pull-right[
```{r ref.label="dplyr3", echo=FALSE}
```
]

---

# Using dplyr verbs

.pull-left[
```{r dplyr4, eval=FALSE}
library(dplyr)
alice %>%
  unnest_tokens(token, text) %>%
  count(chapter, token)
```
]

.pull-right[
```{r ref.label="dplyr4", echo=FALSE}
```
]

---

# Using dplyr verbs

.pull-left[
```{r dplyr5, eval=FALSE}
library(dplyr)
alice %>%
  unnest_tokens(token, text) %>%
  group_by(chapter) %>%
  count(token) %>%
  top_n(10, n)
```
]

.pull-right[
```{r ref.label="dplyr5", echo=FALSE}
```
]

---

# Using dplyr verbs and ggplot2

.pull-left[
```{r dplyr6, eval=FALSE}
library(dplyr)
library(ggplot2)
alice %>%
  unnest_tokens(token, text) %>%
  count(token) %>%
  top_n(10, n) %>%
  ggplot(aes(n, token)) +
  geom_col()
```
]

.pull-right[
```{r ref.label="dplyr6", echo=FALSE}
```
]

---

# Using dplyr verbs and ggplot2

.pull-left[
```{r dplyr7, eval=FALSE}
library(dplyr)
library(ggplot2)
library(forcats)
alice %>%
  unnest_tokens(token, text) %>%
  count(token) %>%
  top_n(10, n) %>%
  ggplot(aes(n, fct_reorder(token, n))) +
  geom_col()
```
]

.pull-right[
```{r ref.label="dplyr7", echo=FALSE}
```
]


