---
title: "High performance computing, cloud computing"
subtitle: "PM 566: Introduction to Health Data Science"
author: "George G. Vega Yon"
output:
  # slidy_presentation
  xaringan::moon_reader:
    css: ["theme.css"]
    lib_dir: libs
    nature:
      beforeInit: "macros.js"
      ratio: "16:9"
      highlightStyle: github
      highlightLines: false
      countIncrementalSlides: false
      titleSlideClass: [center, middle]
  #   code_download: true
---

<!--Yeah... I have really long code chunks, so I just changed the default size :)-->
<style type="text/css">
code.r,code.cpp,code{
  font-size:medium;
}
</style>

# Part I: intro

---

## Today's goals

We will learn about how to manipulate data, and in particular, creating/modifying variables
taking the following into consideration:

- Groups
- Shifted
- Date/time types
- Factor variables
- Text variables
- Presence of missings

We will want to create summaries of the data.

---

## Scenarios

1. The 9, 99, 999, ... coding for missigness.

2. The data contains dates

3. The data is a panel dataset with various measures per unit, and we need to create a lag

4. Need to create some summaries at the group level

5. Have two datasets and need to merge them by one or more keys/indices/ids.

6. Create a running mean spanning the last 7 observations.

---

## Data Management: data.table

The data.table package:

- Is very fast
- Is memory efficient
- Is 

---

## Benchmarks

- [H2O.ai](https://www.h2o.ai/)'s benchmark ([link](https://h2oai.github.io/db-benchmark/)): Designed by
  the lead developer of data.table [Matt Dowle](https://rdatatable.gitlab.io/data.table/)

- [RStudio's](https://rstudio.com) benchmark ([link](https://cran.r-project.org/web/packages/vroom/vignettes/benchmarks.html)):
  Designed as part of the benchmarks with the [vroom](https://cran.r-package.org/package=vroom) package.

---

## Generating summary statistics

```{r read-in, cache=TRUE}
library(data.table)

# Month of august
dat <- fread("met_200.gz")

# Generating a date component
dat[, Date := as.IDate(paste(year, month, day, sep = "-"))]

# Generating the daily averages of Atmospheric pressure and temperature per
# station
dat_daily <- dat[
  ,
  list(
    atm.press_avg = mean(atm.press, na.rm = TRUE),
    temp_avg      = mean(temp, na.rm = TRUE)
  ),
  by = c("USAFID", "Date", "lat", "lon")
]
```


---

```{r}
# Monthly average temperature plot
library(ggplot2)
library(akima)
dat_daily_plot <- with(
  dat_daily[mday(Date) == 1 & is.finite(temp_avg)],
  akima::interp(
    x = lon, y = lat, z = temp_avg
  )
)

image(dat_daily_plot)
```

